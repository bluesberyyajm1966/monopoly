<script>
  const canvas = document.getElementById("boardCanvas");
  const ctx = canvas.getContext("2d");

  const propertySize = 80;
  const boardSize = canvas.width;

  const properties = Array.from({ length: 40 }, (_, i) => ({
    name: `Property ${i}`,
    color: getPropertyColor(i),
    price: 100 + i * 10,
    type: getPropertyType(i)
  }));

  function getPropertyColor(i) {
    const colorSets = [
      '#8b4513', '#8b4513',
      '#add8e6', '#add8e6', '#add8e6',
      '#ff69b4', '#ff69b4', '#ff69b4',
      '#ff4500', '#ff4500', '#ff4500',
      '#ffff00', '#ffff00', '#ffff00',
      '#008000', '#008000', '#008000',
      '#0000ff', '#0000ff', '#0000ff'
    ];
    return colorSets[i % colorSets.length];
  }

  function getPropertyType(i) {
    if ([0, 10, 20, 30].includes(i)) return 'corner';
    if ([5, 15, 25, 35].includes(i)) return 'railroad';
    if ([12, 28].includes(i)) return 'utility';
    return 'property';
  }

  function drawBoard() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw corners
    drawCorner(0, boardSize - propertySize, boardSize - propertySize, 'GO');
    drawCorner(10, 0, boardSize - propertySize, 'JAIL');
    drawCorner(20, 0, 0, 'FREE PARKING');
    drawCorner(30, boardSize - propertySize, 0, 'GO TO JAIL');

    // Draw bottom row (1-9)
    for (let i = 1; i < 10; i++) {
      drawProperty(i, boardSize - propertySize * (i + 1), boardSize - propertySize, 'bottom');
    }

    // Left row (11–19)
    for (let i = 11; i < 20; i++) {
      drawProperty(i, 0, boardSize - propertySize * (i - 9), 'left');
    }

    // Top row (21–29)
    for (let i = 21; i < 30; i++) {
      drawProperty(i, propertySize * (i - 20), 0, 'top');
    }

    // Right row (31–39)
    for (let i = 31; i < 40; i++) {
      drawProperty(i, boardSize - propertySize, propertySize * (i - 30), 'right');
    }
  }

  function drawCorner(index, x, y, label) {
    ctx.fillStyle = "#fff";
    ctx.fillRect(x, y, propertySize, propertySize);
    ctx.strokeRect(x, y, propertySize, propertySize);
    ctx.fillStyle = "#000";
    ctx.font = "14px Arial";
    ctx.textAlign = "center";
    ctx.fillText(label, x + propertySize / 2, y + propertySize / 2);
  }

  function drawProperty(index, x, y, side) {
    const prop = properties[index];
    ctx.fillStyle = "#fff";
    ctx.fillRect(x, y, propertySize, propertySize);
    ctx.strokeRect(x, y, propertySize, propertySize);

    // Draw color bar
    ctx.fillStyle = prop.color;
    switch (side) {
      case 'bottom':
        ctx.fillRect(x, y, propertySize, 15);
        break;
      case 'top':
        ctx.fillRect(x, y + propertySize - 15, propertySize, 15);
        break;
      case 'left':
        ctx.fillRect(x + propertySize - 15, y, 15, propertySize);
        break;
      case 'right':
        ctx.fillRect(x, y, 15, propertySize);
        break;
    }

    // Rotate text to face outside
    ctx.save();
    ctx.translate(x + propertySize / 2, y + propertySize / 2);
    switch (side) {
      case 'bottom': ctx.rotate(0); break;
      case 'left': ctx.rotate(-Math.PI / 2); break;
      case 'top': ctx.rotate(Math.PI); break;
      case 'right': ctx.rotate(Math.PI / 2); break;
    }
    ctx.fillStyle = "#000";
    ctx.font = "10px Arial";
    ctx.textAlign = "center";
    ctx.fillText(prop.name, 0, 4);
    ctx.restore();
  }

  function updateProperty() {
    const index = parseInt(document.getElementById("property-index").value);
    const name = document.getElementById("property-name").value;
    const color = document.getElementById("property-color").value;
    const price = parseInt(document.getElementById("property-price").value);

    if (!isNaN(index) && properties[index]) {
      properties[index].name = name || properties[index].name;
      properties[index].color = color || properties[index].color;
      properties[index].price = isNaN(price) ? properties[index].price : price;
      drawBoard();
    }
  }

  function downloadBoardImage() {
    const link = document.createElement("a");
    link.download = "monopoly_board.png";
    link.href = canvas.toDataURL("image/png").replace("image/png", "image/octet-stream");
    link.click();
  }

  drawBoard();
</script>

